(Transcribed by TurboScribe.ai. Go Unlimited to remove this message.)

The logs of the service and you determine how your monitoring should look like, what do you want to monitor and what do you want to alert on and what do you want to ignore right from the logs. So, to start with, you will have to first, since Jonathan mentioned that it's in dev and QA, I'm just usually I go with QA but this time since he showed us dev, I'm just going to do a raw log search for that specific service in dev. So, if I just do a raw log search for 7 days just to see how it looks, I get a lot of these, you know, these are all the usual events that are associated with a lambda.

And the log messages are actually these ones. So, the first step, so what we do is the moment I see the logs, okay, now I have to start filtering the logs, so I just see what I want to see. I don't want to see all the unnecessary events, so these are all unnecessary because I'm not going to anyways, I'm not going to show them in any of my reports, right.

So, what I do is, so for every lambda, you have these set of logs, so I'm just going to do a log and I'm going to ignore all of these logs. These log patterns, so I'm going to ignore and this gives me all the logs of this lambda. In this case, for that specific service.

So, if you come all the way down, you verify that, okay, I'm now seeing all of the logs for the service that I'm bothered about. And for this, the next step that you want to see is, okay, how many times does the service run in a day? In this case, he told that it's going to be once a day, but there are cases where the service is running in real time and you have no idea. So, the next step or the next process to follow is, you have to start pulling by a single thread.

So, in this case, usually there will be some kind of unique value for every single transaction, right? That can be a transaction ID, document ID or a request ID. In this case, there is no, looking at the logs on a higher level, there is no transaction. If you go all the way back, there is no transaction ID.

All you can see is a request ID and there is a field. So, this is kind of a unique identifier for every transaction that's going to be, that this lambda is going to process or that, you know, every record that the lambda is going to process. So, we now filter this for a specific request ID.

And you see, you got what you wanted. This is from the 16 midnight log. So, you have around 29 logs.

So, there are 29 logs specific to this specific request ID in this case. So, all you have to do is first start reading through the log messages. So, if you see below the start request ID, we don't need this also.

So, I'm just going to filter this. And so, my job is to start reading through and understanding each and every log before I start. Because if you have to visualize something like this, you will have to know, okay, what does the log tell me, what the service actually does.

I mean, we know that Jonathan did give us an overview of, okay, this is what the service does, this is what you do. But there are times where they just give us a wiki and they're like, okay, I need the monitoring for this. So, at that point, logs are the only place where we are going to get all possible information, right? So, the first log, you always, you don't come from the beginning.

I mean, you don't start reading from the log number one. You always come from behind because that's where, that's the flow of logs. This is where the Lambda is initialized.

Initializing, which we all know. Yeah, bottom to top, right? Sorry, what did you say? Bottom to top, right? Yes, yes, yes. Correct.

So, the Lambda is initialized and the next immediate log is retrieving a parameter. It's trying to retrieve a parameter from the parameter store. They have the parameter name.

That is good. It's trying to retrieve and the next thing is it's querying database for planning data. Starting database query, that's the message.

Okay, so it's trying to query against the database. I go to this log and it's using last updated timestamp. So, this last updated timestamp is again stored in the database and they are fetching the data.

So, they are fetching all of the data since this last updated timestamp, right? The next thing is executing data, which, you know, it's just they have given us the query. This is an unnecessary log. We don't have to add this log.

We even told him that day that this log is not needed because we don't bother about what query or what execution is happening in the backend, right? So, they gave us another duplicate log that says executing database query and the message is even the same. Okay, let's hold on here and let's keep reading. The next thing is again, see the same query with the same thing.

So, this is an exact duplicate. We don't need this. Though the text differs, this is again an exact duplicate.

So, all we know is that we are retrieving a parameter that's the date and we are querying a database for all the records greater than this date, right? So, this is what we know till now and the next important log is. So, what do you see? It says creating database connection pool. So, this is where we are trying to connect to the database, right? After you see this creating message, you see another retrieving parameter.

This is the username and password. I think this is the database username and password because he told us that it's a SQL server. So, they have a username and password.

They are fetching it from the parameter store and after they fetch database pool creation successful. So, which means the database connection is successful. Okay, now they have connected to the database.

What do they do next? Next, what do they do is query executed. So, there was this query that was logged below. So, they are trying to execute this query from the date that was fetched.

So, if you see here, you come up and they say query executed successfully and they gave us a record count. This is the important thing that we have to know. So, at this point, all we know is they are trying to connect to a database and execute a query and fetch the record count for us.

510 records this time. Okay, perfect. And another log that says database query completed.

Okay, fine. This log is still enough but they are giving us another log. Okay, fine.

You take it in your head. Next, you go on and what do they say? Next thing is starting Couchbase upload. So, if you remember from the call that we had last week, there were two aspects to this Lambda.

One is the Lambda is trying to fetch all the stuff from the SQL Server database and it is going to update or upload. Upload in the sense, update the documents in Couchbase. If the stuff is already there, it is going to update.

If it is not there, it is going to create. It is the same like what the doc upload thing does but it is coming from the SQL Server. That is the difference.

So, what they say is starting Couchbase upload. Okay. And uploading 510 records to Couchbase.

Okay. They are trying to upload. Processing, planning.

So, they are trying to do some data formatting before they try and upload to Couchbase. That is this log processing, planning data and they are doing the duplicates removed. So, here they gave us the original count, unique count and the duplicate count.

Well done. Good. That is good.

And then processing. So, he also told us that he has a batch process in place. The maximum size is 500.

And so, he is just processing these many because there are only 206 valid records we have to process in this batch. So, the rest are duplicates, right? Exactly so. Yes.

Perfect. So, he is trying to, this log says processing. Okay.

Good. HTTP client. We do not have to know this.

Ignore this log. Next thing is checking documents in batch. This is again a duplicate.

I mean, this is again an extra unnecessary log because we already know that they are processing it in batches. Okay. Then they say batch check completed.

So, out of this 206 in total, there are already 204 records that are existing and only two of them have to be created. That is what they mean by existing and new. Batch check done.

204 existing. Two new. Okay.

And then you come all the way up and you say documents prepared for upload. So, they are doing some manipulation in the backend and they are giving us a log that, okay, the Lambda is now preparing the documents. And if you see, and they gave us a count, total docs, new docs, updated docs.

They gave us a count, which is good. Uploading documents to Couchbase. Documents uploaded successfully.

Couchbase upload completed. And they gave us this beautiful final record count. If anything had failed, they would have logged it and failed.

Right? And finally, since the Couchbase upload is successful, they will have to update this parameter store back with the updated time. So, they say that storing parameter. Parameter stored successfully.

Updated last fetched timestamp. Because we have to, once after this is updated, when the Lambda runs the next day, it will pick up records from this day. This specific timestamp.

Right? So, we have to update the timestamp back. And the Lambda finished. So, we read the whole logs.

And now, we kind of have an idea of, okay, this is what is happening. The Lambda is fetching some stuff from the database based on a specific date. It's running some queries.

And it is trying to upload the stuff into Couchbase. That is the, so, two aspects. Database side, Couchbase side.

That is the whole, this is the job of the whole Lambda. Now, there are these hundreds of events in between. There are 28 events.

And it's, all 28 events are not as important. Right? So, for instance, what I did was, I split those events into, so, what I just, so, next step is, you are new to Sumo. You don't know, so, I'm showing you all.

Okay? So, now, the important stuff or important field that we need right now in this case is this event. Because you need a starting point. You have to somehow start at some point.

Right? So, one is event. And next is this message. Because these two only, so, these two only give us all necessary info about the Lambda's flow of steps or flow of events.

Right? So, you parse out these two specific fields. So, how you can do it, you go to a specific field like click and parse selected key. So, that's going to come in.

And you do a, you read it. This is raw parsing, right? The raw parsing. Uh-huh.

Raw parsing is like this. You click on, do you see a view as raw? You click on this. Yes, yeah.

And this will be used when there's a specific pattern. So, you do this parse selected key. And you, if you want a specific value, you click and you click extract value.

It becomes a star. And you give the name of the field. You're like, this is the name I want.

So, for event, this is, so, I'll show you what is the difference. This is the event that I parsed. Okay? I'll do this event.

And I just parse one more field. This is the message field. I want to parse and message.

Now, if you click on submit, it is going to, so, this is the raw log parsing. So, it's going to parse all the logs that match this specific pattern. We don't need it now.

Because all our raw logs are in a different way. So, we don't use this parsing in this sense. This parsing will mainly be used for sync k2 logs.

Because sync, okay, that's a different story. But I'll show that to you later. But for now, forget this raw log.

So, when you talk about raw log parsing, it's converting, I mean, it's clicking on this, making the raw, making the logs in a raw format, underscore raw format, and just, you know, parsing it out. That is different. But in this case, it's beautifully configured as a JSON.

So, we'll be going with the JSON parsing. Okay? But this is a good question that I'll show the significance after we are done with this thing. Sure.

Like how or when you need that, okay? So, first thing is, filter out all the logs that you don't want. I don't have to see or I don't bother about these logs. So, filter all these out.

Put a not in the front, which means it's not going to show you any of the logs that match the pattern here. And start pulling by a thread. If you have doc ID, document ID as a part of the logs, start querying based on the document ID.

And there's going to be a new doc type for this one as well, right? No, this is not like that. Remember during the call with Jonathan, there was a new doc type he mentioned? To query in LazyBoy? Yeah, but they don't talk about any of this here. Oh, okay.

Doc type engage CMDB. So, they're not talking about any of that here. So, yeah.

But we are really figuring out what to do with the logs that we have for this Lambda. So, the two main events that we have that gives us all the information to begin with are these event and message. So, I parsed it out.

For now, let's leave the message because message is just for you to understand. So, in this case, starting Couchbase upload. This event doesn't tell you.

If you cannot figure out what this event means, this message is going to give you an explanation of that event. Okay, they are trying to upload these many records to Couchbase. This is where maybe the doc type thing will come into play.

But this Lambda doesn't log the info, so let's leave it for now. Yeah, like you won't just understand the context from the event. It just says starting the upload, right? Yes.

That's why we parse out the message as well. Yes, yes. If, I mean, as you work more and more and once you have the call with the dev, you'll understand.

But since we are starting just on an initial level, we'll do all this. So, next thing is what I, this is my approach. You are free to follow like however you're comfortable.

So, once I have this service, there are some services with hardly two or three events and some with these many events. So, my practice is to put them all in a sheet. So, I split it into two categories.

This is the database side of events and this is the Couchbase side. Right? So, I put them all in Excel and I, I mean, I literally pasted all of the events and I started reading from here. Because it's easy, it's in one screen.

In Sumo, it's like scrolling up and down and I'm not comfortable with that thing. So, this kind of gives me a whole picture of all of the events for that Lambda. So, now, let's start with this initializing.

So, now, we have to, first, we have to figure out. So, the left one is from the events, right? Everything is from the events. Everything is an event.

These are all the database side of events. Where did you get the database side? Did you get that from Sumo as well? Yeah, yeah, yeah. I just copied all this initializing, copied, pasted.

Initializing. But where is like the 500 documents to upload? The message? Message, I'm talking only about the events. I'm not talking about this message field.

I don't want the message field for now. Because I'm trying to understand. So, what on the right side is also events? Yes, sir.

Oh, so why do you separate like the columns? I was just going to say that. So, the Lambda, the Lambda is doing two things at a time. It's fetching from the database and it's uploading into Pouch Space.

Right? So, that is why these are all the events that are specific to the database side of work. So, it's like sorting it. Oh, okay.

These are all from me. So, first, my thought was to give separate panels. One panel for the database, one panel for the Couch Space side.

But then, you know, my thinking changed. So, I'll explain. So, what you do is you necessarily, I mean, it's up to you.

You take or you figure out all the events from, because event is a very important field that we use in our monitoring. Because we have to frame our panels around it. So, I copied the events.

And if you see, there are a lot of them. To me, I don't have to show all of these. Because if you just look at a dashboard, you have to, the moment you look at it, like, if I, yeah, maybe this.

If I just look at this dashboard, I should be able to, okay, in a minute, I should be able to say, okay, it's good. It's not good. So, if I'm going to log all of these 29 events in a panel, it's going to look very clumsy.

So, now is when I start filtering it out. Okay, do I need this or I don't need it, right? So, to do that, first, we go over, we look and read at every event and see if it's really needed or not. First thing is initializing.

Yes, I need it because that tells me that the lambda is initialized. So, I'm going to keep it. The next thing is retrieving parameter.

So, this main, all of the main values for this lambda are all stored in a parameter. So, again, this is also needed. So, I'm going to keep it.

Querying database for planning. Sorry. Querying database for planning.

Querying database for planning data. This says that they are starting to build a query. They are just building the query.

This is needed. And using last updated timestamp. This, I kind of decided we don't need it because we don't have to know the intricate details of what the, I don't have to show it in a panel.

So, once you get an alert that there is something wrong with the lambda, you can anyways query the lambda logs and you can do the research yourself. All events need not be on the panel. So, I decided to remove it.

So, I'm going to keep the parameter. So, I'm not using, I don't want this. I'm going to exclude this.

So, I put it in red. Executing planning data query. So, now, I saw the logs a hundred times.

So, I kind of know. Executing planning data query. This is not needed because they are just giving us a query and the modified date.

It is a log that can be here, but it need not come in my panel. So, it's not needed. So, I'm ignoring this query and executing database query.

This, I'm kind of going to keep. So, first, I thought I'm not going to keep this too, but when I started going through the rest of the events, I thought having this would make sense. I'll tell you how.

Executing database query. I'm going to ignore this because I don't need the query and stuff. That's not needed.

And here is where they are creating the connection. So, a hundred percent I'm keeping this. Because establishing connection to the database is a very important event that I have to show in the panel.

I'm going to keep this. Parameter username and password. Yes, I'm going to keep database connection created.

I'm going to keep this. Next thing is query executed successfully. This is again an important log because this tells us if there's any issue with the database query execution.

Since I'm going to keep this, I decided that I'm going to keep this guy. Executing database query will be here. And after this, creating database connection, retrieving the parameters, connection successful, query executed successfully.

So, this gives me a closure from starting query, connecting to the database, executing the query successfully, right? And database query completed. I mean, these two are necessarily the same thing. So, before the call, I was just thinking if we need, if we can just keep one of this.

I mean, that's fine if it can be both. So, this till here is where the database part is. So, till here, the database part is done.

So, that's where you see these events. These are all the database-specific events. After this, if you see, they are starting Couchbase upload, blah, blah, blah.

It's all on the Couchbase site. Why do you keep duplicate of retrieving parameter? It's a different parameter. This is a password parameter.

This is a user name. I think you should denote it so you don't get confused. Sorry, what is it? I think you should differentiate when you're looking at this.

Yeah, even me should have been retrieving this parameter, but I don't want it like that. See, all these are not major. So, this is a very valid scenario.

In some cases, the event name would hardly make sense. So, in those cases, we push back to the developer and say, please rename this event and give me the fresh logs. Because how would you know which one is it if you just see retrieving parameter, right? Yes, yes, yes.

So, maybe you can go with the message tab, but in this case, it's okay. As long as you see this database created successfully, it doesn't matter. I mean, database connection tool created successfully, it doesn't matter.

But in some cases, if it's highly important, you will have to ask them to just rename the event and give you a fresh set of logs, right? So, at this point, the database stuff is done. So, I'm going to stop here, and now we are going to work on the exclusion. So, initializing, yes, the Lambda is initializing.

Retrieving parameter is nothing but the date value they are trying to retrieve. So, I'm going to keep it, because parameter retrieval is a very big part of this Lambda. I'm not going to ignore.

Third thing is querying, which means they are starting to build a query. Yes, I'm going to keep it. Using last updated, this is just extra information.

I'm going to remove it. Executing, planning data query. This is the event where they had the whole query.

I'm removing it. Executing database query. Of course, I want it, because they have this query executed successfully.

So, to match this and this, I'm going to have this. This is just to say that it started, and this says that it ended. So, I'm going to have this.

This is, again, where the SQL query was there, so I'm going to remove it. I don't want it. Creating database connection pool.

Of course, I want it. I'm going to keep it. And these two retrieving parameters are the username and password.

So, we are going to have it. So, maybe when we write our panels, we can do the renaming. We can maybe rename it, like retrieving username parameter, retrieving password parameter.

We can do the renaming. I'll show you how to do. We can do that ourselves.

And database pool connection. Of course, yeah, because this tells me that the connection was successful. And query executed, database query.

So, this kind of concludes the database side of things, right? So, three events are being excluded, and all the red ones are the exclusions, and the black ones are all going to go in the panel. What kind of panel? How do you set up the panel? I'm going to come to that. But for now, this is how I personally analyze.

And I think Anders also does the same thing. So, first, when we get a service, we try to visualize all of the events. Like we do, we call it the all events panel.

So, we try to visualize all of the events from the Lambda without any exclusions at first. To see, okay, do I need this many? Or should I exclude? Or no, I don't. I can't exclude.

I need all this, right? So, that kind of work is what we are doing here. Next thing is starting Couchbase upload. Okay, very good.

It's starting. Then processing planning data for Couchbase upload. So, this is where they're trying to see how many records have come in.

Yes, I'm keeping it. Duplicate removal. Duplicate removal is a good step.

Let's keep it. Processing records in batches. This tells us, when you see this event, this gives you a reminder that, okay, this Lambda works on batch processing, 500 records per batch.

Okay, keep it. HTTP client initialized. This is the backend call.

We don't need it. Leave it. Ignore checking documents in batch.

This is just another FYI kind of blog. Checking documents. Checking 206 documents.

I know there are 206 documents, so I'm ignoring this log. This is not needed. I don't need to see the duplicate logs, right? So, batch check completed, which is good.

Documents prepared. Uploading. All these are very, very important.

So, documents prepared for upload. So, this is where I think they give us the number of docs. Total docs.

New docs. So, when they say new docs, it's nothing but the two docs. And it says two, which means two documents were created in Couchbase.

Updated docs 204. Existing documents were there. They were all updated.

So, I am, for now, let's keep it, but once we start writing the panels, we'll see, and we can do the exclusions later. Uploading documents to Couchbase. It is important.

Let's keep it. Documents uploaded successfully. Good.

We'll keep it. And this is the final wrapper. Total call.

I mean, the total wrapper completed. Couchbase upload successful. And once the upload is successful, they have to update the date.

That's the parameter. So, they are trying to give you an update, trying to store the parameter. Storing the parameter successful.

And updated fetch last time. So, I think this is a field in the database. This parameter value is nothing but this field.

So, I'm keeping this as well. And finished event for CM. This is the final, final wrapper.

Wrapper in the sense, I mean, a principal wrapper and under that wrapper are all these events. So, this is the final wrapper. Scheduled execution completed successfully.

With a record count. State success. This is the only thing that matters, ideally, if you think about it.

This is the only important event that matters. So, now, I did this reading here. I have it in my mind.

I now go look at the event. And I tried and explore these events. I'm thinking this is in a question mark state.

If I want to exclude or remove, we'll see to it when we start writing our panels. So, based on this, I now kind of have an idea of, okay, I'm going to not bother about these events that are in red. The rest of it, I'm definitely going to show.

Right? So, the next point is, okay, now we have to visualize, okay, how do I want my dashboard to be? There are two ways in which you can show your, in which you can build your dashboards. One is giving them each and every detail. Like giving them, like, all these are the events.

All these are the events. It was successful or failed or blah, blah, blah. But in this case, what does this lambda do? It takes a bunch of stuff from the database.

It runs a query, and it updates into Couchbase. That is all it does. So, our job is done when we just show this event, finished event for CMDB lambda.

And scheduled successful, scheduled execution successful, and it also gives us the record count. If we just show this on an every, and it's going to run only once a day for now. I don't know if Jonathan is going to make it, you know, if he's going to implement retries.

You said there was already a retry logic implemented. No, no, no, no. That is specific for 404.

That's specific for syndicated conflicts. Yeah. But that is internal.

I mean, if you see some failures here, if you see failed, scheduled execution failed, I'm talking about those retries. Internal retries, the lambda will handle it itself. That's not the case here.

So, now, all we know is it's going to run once a day, and it is just going to update, take some stuff from the database and update it to Couchbase. So, it is just enough if we just show the update to Couchbase was successful or not. Right? So, first, we will start writing our queries.

So, for now, first to begin with, we will be writing our queries to form a panel in a dashboard that's going to just show this event. So, now, we have... So, I am only talking about this event. Finished events for... Okay.

I can't do finished. Let's do... So, let's match this keyword. Event for CMDB lambda.

So, if you match this, it's just going to be this. So, we can't do finished event for CMDB lambda because we don't know how the failure message is locked. So, let's just leave this finished part and let's do event for CMDB lambda.

And we have the event and message. And let's take the record count for now. So, we might want the record count to ask record count and... I know it's all gray right now, but once... No, that's cool.

That's cool, yeah. Message record out. Right? So, this is what I really want to see for this event.

For this message, this is the record count. And underscore count is coming because I am doing a count. So, we are going to make it look a little better.

So, what I'm going to do is I'm going to display it on a daily basis. Once I put it in the dashboard, it will make more sense. So, let me show you the output.

And I am getting that date here. So, this is nothing but on an everyday, day-to-day basis for 16-11. I don't know why I want it to be... Did it work? It worked.

This is a specific format. What's the format? I forgot. MO maybe? Oh, sorry.

It's US. MMDD. My bad.

Undetermined code. Where is it? So, on 11-16-11... Sorry, November 16th, this is the event. And it was successful.

And the records it processed was around 510. This is good enough to see... Okay, today, somebody is asking you if the CMDB Lambda ran. So, you need to come here and you just see this event in the panel.

Yeah, today's run was successful. I see this message. Now, you are just seeing a single record here because I have just queried for this specific request ID.

So, if I'm going to filter this out and it's running, the query is running for the past seven days, you see here that you see a lot of events. So, you order by the date and you see, you know, finished. Lambda schedules, completed successfully.

No data to process. And the record count is zero. That is still valid if there is nothing to process.

And it's beautifully done. They are logging the message beautifully. So, all you have to do is just show them this.

So, you have to make...

(This file is longer than 30 minutes. Go Unlimited at TurboScribe.ai to transcribe files up to 10 hours long.)